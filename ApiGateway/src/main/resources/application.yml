# 1. Identidad y Puerto del Gateway
server:
  port: 9000

spring:
  application:
    name: api-gateway

  # 2. Seguridad (Keycloak)
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: "http://keycloak:8080/realms/transporte-realm/protocol/openid-connect/certs"

  # 3. Configuraci칩n del Gateway
  cloud:
    gateway:
      routes:
        # ---- Ruta para ServicioCliente ----
        - id: servicio-cliente-route
          uri: http://servicio-cliente:8081
          predicates:
            - Path=/api/v1/clientes/**, /api/v1/seguimiento/**, /api/v1/clientes
          filters:
            - RewritePath=/api/v1/(?<segment>.*), /api/v1/$\{segment}

        # ---- Ruta para ServicioEnvios ----
        - id: servicio-envios-route
          uri: http://servicio-envios:8082
          predicates:
            - Path=/api/v1/envios/**, /api/v1/tramos/**, /api/v1/transportista/**, /api/v1/rutas/**, /api/v1/debug/**
          filters:
            - RewritePath=/api/v1/(?<segment>.*), /api/v1/$\{segment}

        # ---- Ruta para ServicioFlota ----
        - id: servicio-flota-route
          uri: http://servicio-flota:8085
          predicates:
            - Path=/api/v1/flota/**
          filters:
            - RewritePath=/api/v1/(?<segment>.*), /api/v1/$\{segment}

        # ---- Ruta para ServicioTarifa ----
        - id: servicio-tarifa-route
          uri: http://servicio-tarifa:8083
          predicates:
            - Path=/api/v1/tarifas/**
          filters:
            - RewritePath=/api/v1/(?<segment>.*), /api/v1/$\{segment}

        # ---- Rutas para Swagger UI ----
        - id: swagger-envios
          uri: http://servicio-envios:8082
          predicates:
            - Path=/servicio-envios/v3/api-docs, /servicio-envios/swagger-ui/**

        - id: swagger-clientes
          uri: http://servicio-cliente:8081
          predicates:
            - Path=/servicio-cliente/v3/api-docs, /servicio-cliente/swagger-ui/**

        - id: swagger-flota
          uri: http://servicio-flota:8085
          predicates:
            - Path=/servicio-flota/v3/api-docs, /servicio-flota/swagger-ui/**

        - id: swagger-tarifa
          uri: http://servicio-tarifa:8083
          predicates:
            - Path=/servicio-tarifa/v3/api-docs, /servicio-tarifa/swagger-ui/**

# 4. Configuraci칩n del Cliente JWT (Keycloak)
# (la configuraci칩n JWT ya est치 definida arriba en el bloque `spring`)
